<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>SQL | Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="前言开这篇博客的缘由是数据库开发要上机了，不得不恶补一下SQL，记录一下语法和常见的题型。更搞笑的是OJ上面的一道题竟然让我百思不得其解，简直怀疑我学了个假SQL（当然最后看估计还是OJ自己错了，同样的代码在lc上是可以跑通的。。） SQL基础知识技巧和注意事项 聚合函数内可以用DISTINCT修饰 注意两张表连接后，如果要用那个连接的字段分组，那么需要指定是那张表。不过如果直接用using就可以">
<meta property="og:type" content="article">
<meta property="og:title" content="SQL">
<meta property="og:url" content="http://example.com/2024/05/21/SQL/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="前言开这篇博客的缘由是数据库开发要上机了，不得不恶补一下SQL，记录一下语法和常见的题型。更搞笑的是OJ上面的一道题竟然让我百思不得其解，简直怀疑我学了个假SQL（当然最后看估计还是OJ自己错了，同样的代码在lc上是可以跑通的。。） SQL基础知识技巧和注意事项 聚合函数内可以用DISTINCT修饰 注意两张表连接后，如果要用那个连接的字段分组，那么需要指定是那张表。不过如果直接用using就可以">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://example.com/2024/05/21/SQL/image.png">
<meta property="og:image" content="http://example.com/2024/05/21/SQL/image1.png">
<meta property="og:image" content="http://example.com/2024/05/21/SQL/image5.png">
<meta property="og:image" content="http://example.com/2024/05/21/SQL/image6.png">
<meta property="og:image" content="http://example.com/2024/05/21/SQL/image7.png">
<meta property="og:image" content="http://example.com/2024/05/21/SQL/image3.png">
<meta property="og:image" content="http://example.com/2024/05/21/SQL/image4.png">
<meta property="og:image" content="http://example.com/2024/05/21/SQL/image2.png">
<meta property="article:published_time" content="2024-05-20T16:10:10.000Z">
<meta property="article:modified_time" content="2024-06-04T15:30:32.951Z">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/2024/05/21/SQL/image.png">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
  
<meta name="generator" content="Hexo 7.2.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"><span class="fa fa-bars"></span></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
        
          <a class="nav-icon" href="/atom.xml" title="RSS Feed"><span class="fa fa-rss"></span></a>
        
        <a class="nav-icon nav-search-btn" title="Search"><span class="fa fa-search"></span></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-SQL" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2024/05/21/SQL/" class="article-date">
  <time class="dt-published" datetime="2024-05-20T16:10:10.000Z" itemprop="datePublished">2024-05-21</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/">数据库</a>►<a class="article-category-link" href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/SQL/">SQL</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="p-name article-title" itemprop="headline name">
      SQL
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>开这篇博客的缘由是数据库开发要上机了，不得不恶补一下SQL，记录一下语法和常见的题型。更搞笑的是OJ上面的一道题竟然让我百思不得其解，简直怀疑我学了个假SQL（当然最后看估计还是OJ自己错了，同样的代码在lc上是可以跑通的。。）</p>
<h2 id="SQL基础知识"><a href="#SQL基础知识" class="headerlink" title="SQL基础知识"></a>SQL基础知识</h2><h3 id="技巧和注意事项"><a href="#技巧和注意事项" class="headerlink" title="技巧和注意事项"></a>技巧和注意事项</h3><ul>
<li>聚合函数内可以用DISTINCT修饰</li>
<li>注意两张表连接后，如果要用那个连接的字段分组，那么需要指定是那张表。不过如果直接用using就可以避免这个问题</li>
<li>什么时候可以直接内连接，什么时候可以左&#x2F;右连接？有的时候，连不上的也要统计，就得左&#x2F;右</li>
</ul>
<h3 id="表的连接"><a href="#表的连接" class="headerlink" title="表的连接"></a>表的连接</h3><ul>
<li>Join(Inner Join) 内连接，如果表之后至少有一个匹配，则返回行。<strong>交集</strong></li>
<li>Left Join 左连接，返回左表所有的行，右表返回匹配行，不匹配的返回NULL <strong>左表+交集</strong></li>
<li>Right Join 右连接，返回由表所有的行，左表返回匹配行，不匹配的返回NULL <strong>右表+交集</strong></li>
<li>Full Join 全连接，只要其中一个表存在匹配，则返回行 <strong>左表+右表+交集</strong></li>
<li>Cross Join 笛卡尔积</li>
<li>左连接和右连接也可以称为左外连接和右外连接，统称为外连接</li>
<li>这些连接方法常常和ON配合使用，<strong>ON条件是在生成临时表时使用的条件</strong>，如果满足条件，就会加入中间结果表，当然对于左右连接来说，即使没有匹配也会保留边的数据。</li>
<li>需要注意的是，ON条件是不和Cross Join配合使用的，这时候要用Where来筛选。这也很好理解，笛卡尔积也可以看成一个“原子操作”，后续的筛选就是对这个中间结果表的筛选了，如果还想着用ON条件，直接用Join或者其他就好了</li>
</ul>
<h3 id="SQL执行顺序"><a href="#SQL执行顺序" class="headerlink" title="SQL执行顺序"></a>SQL执行顺序</h3><ol>
<li>FROM </li>
<li>JOIN </li>
<li>ON  </li>
<li>WHERE </li>
<li>GROUP BY </li>
<li>WITH {CUBE | ROLLUP} </li>
<li>HAVING </li>
<li>SELECT -&gt; DISTINCT </li>
<li>ORDER BY </li>
<li>LIMIT OFFSET</li>
</ol>
<h3 id="窗口函数"><a href="#窗口函数" class="headerlink" title="窗口函数"></a>窗口函数</h3><h4 id="ROW-NUMBER-函数"><a href="#ROW-NUMBER-函数" class="headerlink" title="ROW_NUMBER() 函数"></a>ROW_NUMBER() 函数</h4><p>ROW_NUMBER() 是一个窗口函数（也称为分析函数），用于为查询结果中的每一行分配一个<strong>唯一的行号</strong>。行号的分配可以根据指定的排序规则进行。</p>
<h4 id="RANK-函数"><a href="#RANK-函数" class="headerlink" title="RANK() 函数"></a>RANK() 函数</h4><p>分配的行号不连续</p>
<h4 id="OVER-子句"><a href="#OVER-子句" class="headerlink" title="OVER 子句"></a>OVER 子句</h4><p>OVER 子句用于定义窗口函数的工作范围。OVER 子句可以包含 PARTITION BY 子句和 ORDER BY 子句，分别用于分区和排序。</p>
<h4 id="PARTITION-BY-子句"><a href="#PARTITION-BY-子句" class="headerlink" title="PARTITION BY 子句"></a>PARTITION BY 子句</h4><p>例如<code>PARTITION BY customer_id</code> 将数据按 customer_id 进行分区。分区的意思是将查询结果集划分成一个个小组，每个小组包含相同 customer_id 的所有行。在每个分区内，行号的计数从1开始，并在每个新分区重置。</p>
<h4 id="效果"><a href="#效果" class="headerlink" title="效果"></a>效果</h4>   <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">ROW_NUMBER</span>() <span class="keyword">OVER</span> (<span class="keyword">PARTITION</span> <span class="keyword">BY</span> customer_id <span class="keyword">ORDER</span> <span class="keyword">BY</span> order_date <span class="keyword">DESC</span>) <span class="keyword">AS</span> rank_tag</span><br></pre></td></tr></table></figure>
<p>   <img src="/2024/05/21/SQL/image.png"></p>
<h3 id="计算函数"><a href="#计算函数" class="headerlink" title="计算函数"></a>计算函数</h3><ul>
<li><p><strong>round(x,d) ，x指要处理的数，d是指保留几位小数</strong><br>这里有个值得注意的地方是，d可以是负数，这时是指定小数点左边的d位整数位为0,同时小数位均为0；</p>
 <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 结果为1100</span></span><br><span class="line"><span class="keyword">select</span> round(<span class="number">1123.26723</span>,<span class="number">-2</span>);</span><br><span class="line"><span class="comment">-- 结果为1120</span></span><br><span class="line"><span class="keyword">select</span> round(<span class="number">1123.26723</span>,<span class="number">-1</span>);</span><br><span class="line"><span class="comment">-- 结果为1123.27</span></span><br><span class="line"><span class="keyword">select</span> round(<span class="number">1123.26723</span>,<span class="number">2</span>);</span><br></pre></td></tr></table></figure></li>
<li><p><strong>IFNULL(expr1,expr2)，如果expr1的值为null，则返回expr2的值，如果expr1的值不为null，则返回expr1的值。</strong></p>
</li>
<li><p><strong>CEILING()</strong> - 返回最小的整数，使这个整数大于或等于指定数的数值运算。</p>
</li>
<li><p><strong>FLOOR()</strong> - 返回最大整数，使这个整数小于或等于指定数的数值运算。</p>
</li>
<li><p><strong>char_length(str)</strong> 计算单位：字符，不管汉字还是数字或者是字母都算是一个字符</p>
</li>
<li><p>**length(str)**计算单位：字节，utf8编码：一个汉字三个字节，一个数字或字母一个字节。gbk编码：一个汉字两个字节，一个数字或字母一个字节。</p>
</li>
<li><p><strong>REPLACE ( string_expression , string_pattern , string_replacement )</strong><br>参数含义：</p>
<ol>
<li>string_expression 要搜索的字符串表达式。string_expression 可以是字符或二进制数据类型。</li>
<li>string_pattern 是要查找的子字符串。string_pattern 可以是字符或二进制数据类型。string_pattern 不能是空字符串 (‘’)。</li>
<li>string_replacement 替换字符串。string_replacement 可以是字符或二进制数据类型。</li>
</ol>
</li>
<li><p><strong>ORACLE</strong> : <strong>translate(string,from_str,to_str)</strong></p>
<ul>
<li>执行时,translate依次检查string中的每个字符是否在from_str中存在，如果不存在，那么这个string中的字符直接返回，如果存在，translate会记下这个字符在from_str中的位置，然后用to_str的同样位置的字符代替string中的这个字符作业返回结果，</li>
<li>举例如下 <code>select translate(&#39;ac&#39;,&#39;ab2&#39;,&#39;00&#39;) from dual;</code>结果：0c</li>
</ul>
</li>
<li><p><strong>SIGN(x)</strong><br>返回参数作为-1、0或1的符号，该符号取决于X的值为负、零或正。</p>
</li>
</ul>
<h3 id="UNION-操作符"><a href="#UNION-操作符" class="headerlink" title="UNION 操作符"></a>UNION 操作符</h3><ul>
<li>操作符合并两个或多个 SELECT 语句的结果。UNION 内部的每个 SELECT 语句必须拥有相同数量的列。列也必须拥有相似的数据类型。同时，每个 SELECT 语句中的列的顺序必须相同。</li>
<li><strong>默认地，UNION 操作符选取不同的值。如果允许重复的值，请使用 UNION ALL。</strong></li>
</ul>
<h3 id="EXISTS-操作符"><a href="#EXISTS-操作符" class="headerlink" title="EXISTS 操作符"></a>EXISTS 操作符</h3>  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> column_name(s)</span><br><span class="line"><span class="keyword">FROM</span> table_name</span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">EXISTS</span></span><br><span class="line">(<span class="keyword">SELECT</span> column_name <span class="keyword">FROM</span> table_name <span class="keyword">WHERE</span> <span class="keyword">condition</span>);</span><br></pre></td></tr></table></figure>
<ul>
<li>EXISTS 运算符用于判断查询子句是否有记录，如果有一条或多条记录存在返回 True，否则返回 False。EXISTS 可以与 NOT 一同使用，查找出不符合查询语句的记录.</li>
</ul>
<h3 id="正则表达式"><a href="#正则表达式" class="headerlink" title="正则表达式"></a>正则表达式</h3><p><a target="_blank" rel="noopener" href="https://www.runoob.com/note/49419">https://www.runoob.com/note/49419</a></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">WHERE</span> last_name REGEXP <span class="string">&#x27;field$&#x27;</span></span><br></pre></td></tr></table></figure>

<h3 id="CASE-WHEN"><a href="#CASE-WHEN" class="headerlink" title="CASE WHEN"></a>CASE WHEN</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CASE</span></span><br><span class="line">   <span class="keyword">WHEN</span> condition1 <span class="keyword">THEN</span> result1</span><br><span class="line">   <span class="keyword">WHEN</span> condition2 <span class="keyword">THEN</span> result2</span><br><span class="line">   <span class="keyword">WHEN</span> conditionN <span class="keyword">THEN</span> resultN</span><br><span class="line">   <span class="keyword">ELSE</span> <span class="keyword">result</span></span><br><span class="line"><span class="keyword">END</span>;</span><br></pre></td></tr></table></figure>
<ul>
<li>注意NULL 的判断是IS NULL</li>
<li>例：现老师要统计班中，有多少男同学，多少女同学，并统计男同学中有几人及格，女同学中有几人及格，要求用一个SQL输出结果。<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">	<span class="built_in">SUM</span> (<span class="keyword">CASE</span> <span class="keyword">WHEN</span> STU_SEX <span class="operator">=</span> <span class="number">0</span> <span class="keyword">THEN</span> <span class="number">1</span> <span class="keyword">ELSE</span> <span class="number">0</span> <span class="keyword">END</span>) <span class="keyword">AS</span> MALE_COUNT,</span><br><span class="line">	<span class="built_in">SUM</span> (<span class="keyword">CASE</span> <span class="keyword">WHEN</span> STU_SEX <span class="operator">=</span> <span class="number">1</span> <span class="keyword">THEN</span> <span class="number">1</span> <span class="keyword">ELSE</span> <span class="number">0</span> <span class="keyword">END</span>) <span class="keyword">AS</span> FEMALE_COUNT,</span><br><span class="line">	<span class="built_in">SUM</span> (<span class="keyword">CASE</span> <span class="keyword">WHEN</span> STU_SCORE <span class="operator">&gt;=</span> <span class="number">60</span> <span class="keyword">AND</span> STU_SEX <span class="operator">=</span> <span class="number">0</span> <span class="keyword">THEN</span> <span class="number">1</span> <span class="keyword">ELSE</span> <span class="number">0</span> <span class="keyword">END</span>) <span class="keyword">AS</span> MALE_PASS,</span><br><span class="line">	<span class="built_in">SUM</span> (<span class="keyword">CASE</span> <span class="keyword">WHEN</span> STU_SCORE <span class="operator">&gt;=</span> <span class="number">60</span> <span class="keyword">AND</span> STU_SEX <span class="operator">=</span> <span class="number">1</span> <span class="keyword">THEN</span> <span class="number">1</span> <span class="keyword">ELSE</span> <span class="number">0</span> <span class="keyword">END</span>) <span class="keyword">AS</span> FEMALE_PASS</span><br><span class="line"><span class="keyword">FROM</span> </span><br><span class="line">	THTF_STUDENTS</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="日期处理"><a href="#日期处理" class="headerlink" title="日期处理"></a>日期处理</h2><h3 id="年月日加减"><a href="#年月日加减" class="headerlink" title="年月日加减"></a>年月日加减</h3><ul>
<li><strong>interval</strong>作为一个关键字时，表示为时间间隔，常用在date_add()、date_sub()函数中，常用于时间的加减法。</li>
<li>直接操作<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span>  hiredate <span class="operator">-</span> <span class="type">interval</span> <span class="number">5</span> <span class="keyword">day</span> <span class="keyword">as</span> hd_minus_5D,</span><br><span class="line">      hiredate <span class="operator">+</span> <span class="type">interval</span> <span class="number">5</span> <span class="keyword">day</span> <span class="keyword">as</span> hd_plus_5D,</span><br><span class="line">      hiredate <span class="operator">-</span> <span class="type">interval</span> <span class="number">5</span> <span class="keyword">month</span> <span class="keyword">as</span> hd_minus_5M,</span><br><span class="line">      hiredate <span class="operator">+</span> <span class="type">interval</span> <span class="number">5</span> <span class="keyword">month</span> <span class="keyword">as</span> hd_plus_5M,</span><br><span class="line">      hiredate <span class="operator">-</span> <span class="type">interval</span> <span class="number">5</span> <span class="keyword">year</span> <span class="keyword">as</span> hd_minus_5Y,</span><br><span class="line">      hiredate <span class="operator">+</span> <span class="type">interval</span> <span class="number">5</span> <span class="keyword">year</span> <span class="keyword">as</span> hd_plus_5Y</span><br><span class="line"><span class="keyword">from</span> emp</span><br><span class="line"><span class="keyword">where</span> deptno<span class="operator">=</span><span class="number">10</span></span><br></pre></td></tr></table></figure></li>
<li>date_add函数<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span>  date_add(hiredate,<span class="type">interval</span> <span class="number">-5</span> <span class="keyword">day</span>) <span class="keyword">as</span> hd_minus_5D,</span><br><span class="line">      date_add(hiredate,<span class="type">interval</span> <span class="number">5</span> <span class="keyword">day</span>) <span class="keyword">as</span> hd_plus_5D,</span><br><span class="line">      date_add(hiredate,<span class="type">interval</span> <span class="number">-5</span> <span class="keyword">month</span>) <span class="keyword">as</span> hd_minus_5M,</span><br><span class="line">      date_add(hiredate,<span class="type">interval</span> <span class="number">5</span> <span class="keyword">month</span>) <span class="keyword">as</span> hd_plus_5M,</span><br><span class="line">      date_add(hiredate,<span class="type">interval</span> <span class="number">-5</span> <span class="keyword">year</span>) <span class="keyword">as</span> hd_minus_5Y,</span><br><span class="line">      date_add(hiredate,<span class="type">interval</span> <span class="number">5</span> <span class="keyword">year</span>) <span class="keyword">as</span> hd_plus_5DY</span><br><span class="line"><span class="keyword">from</span> emp</span><br><span class="line"><span class="keyword">where</span> deptno<span class="operator">=</span><span class="number">10</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="常见的时间粒度-interval"><a href="#常见的时间粒度-interval" class="headerlink" title="常见的时间粒度 interval"></a>常见的时间粒度 interval</h3><ol>
<li>MICROSECOND</li>
<li>SECOND</li>
<li>MINUTE</li>
<li>HOUR</li>
<li>DAY</li>
<li>WEEK</li>
<li>MONTH</li>
<li>QUARTER</li>
<li>YEAR</li>
</ol>
<ul>
<li>日期取部分</li>
</ul>
<ol>
<li><code>select day(createtime) from life_unite_product</code> –取时间字段的天值</li>
<li><code>select month(createtime) from life_unite_product</code> –取时间字段的月值</li>
<li><code>select year(createtime) from life_unite_product</code> –取时间字段的年值<br><img src="/2024/05/21/SQL/image1.png"></li>
</ol>
<h3 id="时间间隔"><a href="#时间间隔" class="headerlink" title="时间间隔"></a>时间间隔</h3><ul>
<li>DATEDIFF() 函数返回两个日期之间的间隔。<br>DATEDIFF() 函数是 SQL Server 中的一个日期函数，用于计算两个日期之间的时间间隔。它接受三个参数：时间间隔单位、开始日期和结束日期，并返回两个日期之间的单位时间间隔。</li>
</ul>
<h3 id="两个日期之间的工作日个数"><a href="#两个日期之间的工作日个数" class="headerlink" title="两个日期之间的工作日个数"></a>两个日期之间的工作日个数</h3><p><a target="_blank" rel="noopener" href="https://geek-docs.com/sql/sql-examples/sql-to-calculate-working-days-between-two-dates.html">https://geek-docs.com/sql/sql-examples/sql-to-calculate-working-days-between-two-dates.html</a></p>
<h3 id="判断闰年"><a href="#判断闰年" class="headerlink" title="判断闰年"></a>判断闰年</h3><ul>
<li>last_day()函数是那个月的最后一天<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span>	<span class="keyword">day</span>(							</span><br><span class="line"> last_day(															</span><br><span class="line">   date_add(</span><br><span class="line">   date_add(</span><br><span class="line">   date_add(<span class="built_in">current_date</span>,</span><br><span class="line">   <span class="type">interval</span>	<span class="operator">-</span>dayofyear(<span class="built_in">current_date</span>)	<span class="keyword">day</span>),</span><br><span class="line">   <span class="type">interval</span>	<span class="number">1</span>	<span class="keyword">day</span>),</span><br><span class="line">   <span class="type">interval</span>	<span class="number">1</span>	<span class="keyword">month</span>)))	dy</span><br><span class="line"><span class="keyword">from</span>	t1</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="判断某年有几天"><a href="#判断某年有几天" class="headerlink" title="判断某年有几天"></a>判断某年有几天</h3><ul>
<li>找到今年的第一天和下一年的第一天<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> datediff((curr_year <span class="operator">+</span> <span class="type">interval</span> <span class="number">1</span> <span class="keyword">year</span>),curr_year)</span><br><span class="line">  <span class="keyword">from</span> (</span><br><span class="line">    <span class="keyword">select</span> adddate(<span class="built_in">current_date</span>,<span class="operator">-</span>dayofyear(<span class="built_in">current_date</span>)<span class="operator">+</span><span class="number">1</span>) curr_year</span><br><span class="line">      <span class="keyword">from</span> t1</span><br><span class="line">    ) x</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="相关函数"><a href="#相关函数" class="headerlink" title="相关函数"></a>相关函数</h3><ul>
<li>DAYOFYEAR() 函数返回给定日期的一年中的哪一天（从 1 到 366 的数字）。</li>
<li>DAYOFWEEK() 函数返回给定日期的工作日索引（从 1 到 7 的数字）。<br>注意: 1&#x3D;星期日，2&#x3D;星期一，3&#x3D;星期二，4&#x3D;星期三，5&#x3D;星期四，6&#x3D;星期五，7&#x3D;星期六。</li>
<li>DAYOFMONTH() 函数返回给定日期的月份日期（1 到 31 之间的数字）。</li>
<li>MONTHNAME() 函数返回给定日期的月份名称。</li>
<li>DAYNAME函数接受1个参数，该参数是要获取其工作日名称的日期。 </li>
<li>CURDATE()获取当前的时间</li>
</ul>
<h2 id="数据处理"><a href="#数据处理" class="headerlink" title="数据处理"></a>数据处理</h2><h3 id="平均值"><a href="#平均值" class="headerlink" title="平均值"></a>平均值</h3><ul>
<li><img src="/2024/05/21/SQL/image5.png" alt="alt text"><br>null可以coalesce(sal,0)函数可以把null变成指定的值，否则这一行直接就不管了</li>
</ul>
<h3 id="最大最小"><a href="#最大最小" class="headerlink" title="最大最小"></a>最大最小</h3><ul>
<li>max,min</li>
</ul>
<h3 id="求和"><a href="#求和" class="headerlink" title="求和"></a>求和</h3><ul>
<li>sum</li>
</ul>
<h3 id="累计求和"><a href="#累计求和" class="headerlink" title="累计求和"></a>累计求和</h3><ul>
<li><img src="/2024/05/21/SQL/image6.png" alt="alt text"><br>sql就是用子查询</li>
</ul>
<h3 id="众数"><a href="#众数" class="headerlink" title="众数"></a>众数</h3><ul>
<li><img src="/2024/05/21/SQL/image7.png" alt="alt text"><br>sql就是对每个统计次数，保证是最多的</li>
</ul>
<h3 id="计算中位数"><a href="#计算中位数" class="headerlink" title="计算中位数"></a>计算中位数</h3><ul>
<li>oracle是比较简单的，直接用median()函数即可<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> median(sal)</span><br><span class="line">		<span class="keyword">from</span>	emp</span><br><span class="line">	<span class="keyword">where</span>	deptno<span class="operator">=</span><span class="number">20</span></span><br></pre></td></tr></table></figure></li>
<li>mysql可以用行数+偏移量（现在好像也不行了，limit后面必须是一个整数常量）<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span>	<span class="built_in">AVG</span>(sal)	<span class="keyword">AS</span>	median_salary</span><br><span class="line"><span class="keyword">FROM</span>	(</span><br><span class="line"> <span class="keyword">SELECT</span>	sal</span><br><span class="line"> <span class="keyword">FROM</span>	emp</span><br><span class="line"> <span class="keyword">ORDER</span> <span class="keyword">BY</span> sal</span><br><span class="line"> LIMIT <span class="number">2</span>	<span class="operator">-</span> (<span class="keyword">SELECT</span>	<span class="built_in">COUNT</span>(<span class="operator">*</span>)	<span class="keyword">FROM</span>	employees)	<span class="operator">%</span>	<span class="number">2</span>	<span class="comment">--Determines	if	the	count	is	odd	or	even</span></span><br><span class="line"> <span class="keyword">OFFSET</span>	(<span class="keyword">SELECT</span>	(<span class="built_in">COUNT</span>(<span class="operator">*</span>)	<span class="operator">-</span> <span class="number">1</span>)	<span class="operator">/</span>	<span class="number">2</span>	<span class="keyword">FROM</span>	employees)	<span class="comment">--Skips	the	first	n	rows	where	n	is	half	of	the	row	count</span></span><br><span class="line">)	<span class="keyword">AS</span>	subquery;</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="百分比"><a href="#百分比" class="headerlink" title="百分比"></a>百分比</h3><ul>
<li>记得*100<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span>	(<span class="built_in">sum</span>(<span class="keyword">case</span> <span class="keyword">when</span>	deptno<span class="operator">=</span> <span class="number">10</span>	<span class="keyword">then</span>	sal <span class="keyword">end</span>)<span class="operator">/</span><span class="built_in">sum</span>(sal))<span class="operator">*</span><span class="number">100</span>	<span class="keyword">as</span>	pct</span><br><span class="line">	<span class="keyword">from</span>	emp</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="SQL字符串"><a href="#SQL字符串" class="headerlink" title="SQL字符串"></a>SQL字符串</h2><h3 id="遍历字符串"><a href="#遍历字符串" class="headerlink" title="遍历字符串"></a>遍历字符串</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> substr(e.ename,iter.pos,<span class="number">1</span>) <span class="keyword">as</span> C</span><br><span class="line"><span class="keyword">from</span> (<span class="keyword">select</span> ename <span class="keyword">from</span> emp <span class="keyword">where</span> ename <span class="operator">=</span> <span class="string">&#x27;KING&#x27;</span>) e,</span><br><span class="line">  (<span class="keyword">select</span> id <span class="keyword">as</span> pos <span class="keyword">from</span> t10) iter</span><br><span class="line"><span class="keyword">where</span> iter.pos <span class="operator">&lt;=</span> length(e.ename)</span><br></pre></td></tr></table></figure>
<ul>
<li>SUBSTR(str,pos,len): 从pos开始的位置，截取len个字符，没有len这个参数就是截取到最后</li>
<li>t10是什么？t_num表一般就是存了1-num的数字，一个num个数。这里使用t10也就是默认了字符串长度不会超过10</li>
<li>我们可以直接不建表，用以下方法实现数据透视表 <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> t2 <span class="keyword">as</span> ((<span class="keyword">select</span> <span class="number">1</span> id) <span class="keyword">union</span> (<span class="keyword">select</span> <span class="number">2</span> id))</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="嵌入引号"><a href="#嵌入引号" class="headerlink" title="嵌入引号"></a>嵌入引号</h3><ul>
<li>连续引号表示引号<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="string">&#x27;It&#x27;&#x27;s a sunny day&#x27;</span> <span class="keyword">AS</span> example_string;</span><br></pre></td></tr></table></figure></li>
<li>转义<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="string">&#x27;It\&#x27;</span>s a sunny <span class="keyword">day</span><span class="string">&#x27; AS example_string;</span></span><br></pre></td></tr></table></figure></li>
<li>CONCAT函数<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> CONCAT(<span class="string">&#x27;It&#x27;</span>, <span class="string">&#x27;&#x27;&#x27;&#x27;</span>, <span class="string">&#x27;s a sunny day&#x27;</span>) <span class="keyword">AS</span> example_string;</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="字符出现次数"><a href="#字符出现次数" class="headerlink" title="字符出现次数"></a>字符出现次数</h3><ul>
<li>统计字符串内有多少个”LL”，记得除一下要找的子串<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line">(length(<span class="string">&#x27;HELLO HELLO&#x27;</span>)<span class="operator">-</span></span><br><span class="line">length(replace(<span class="string">&#x27;HELLO HELLO&#x27;</span>,<span class="string">&#x27;LL&#x27;</span>,<span class="string">&#x27;&#x27;</span>)))<span class="operator">/</span>length(<span class="string">&#x27;LL&#x27;</span>)</span><br><span class="line"><span class="keyword">as</span> correct_cnt,</span><br><span class="line">(length(<span class="string">&#x27;HELLO HELLO&#x27;</span>)<span class="operator">-</span></span><br><span class="line">length(replace(<span class="string">&#x27;HELLO HELLO&#x27;</span>,<span class="string">&#x27;LL&#x27;</span>,<span class="string">&#x27;&#x27;</span>))) <span class="keyword">as</span> incorrect_cnt</span><br><span class="line"><span class="keyword">from</span> t1</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="删除字符"><a href="#删除字符" class="headerlink" title="删除字符"></a>删除字符</h3><ul>
<li>删除元音和0<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> ename,</span><br><span class="line">  replace(</span><br><span class="line">  replace(</span><br><span class="line">  replace(</span><br><span class="line">  replace(</span><br><span class="line">  replace(ename,<span class="string">&#x27;A&#x27;</span>,<span class="string">&#x27;&#x27;</span>),<span class="string">&#x27;E&#x27;</span>,<span class="string">&#x27;&#x27;</span>),<span class="string">&#x27;I&#x27;</span>,<span class="string">&#x27;&#x27;</span>),<span class="string">&#x27;O&#x27;</span>,<span class="string">&#x27;&#x27;</span>),<span class="string">&#x27;U&#x27;</span>,<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">  <span class="keyword">as</span> stripped1,</span><br><span class="line">  sal,</span><br><span class="line">  replace(sal,<span class="number">0</span>,<span class="string">&#x27;&#x27;</span>) stripped2</span><br><span class="line"><span class="keyword">from</span> emp</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="分离数字和字母"><a href="#分离数字和字母" class="headerlink" title="分离数字和字母"></a>分离数字和字母</h3><ul>
<li>ORACLE<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* Oracle */</span></span><br><span class="line"><span class="keyword">select</span> replace(</span><br><span class="line"> <span class="built_in">translate</span>(data,<span class="string">&#x27;0123456789&#x27;</span>,<span class="string">&#x27;0000000000&#x27;</span>),<span class="string">&#x27;0&#x27;</span>) ename,</span><br><span class="line"> to_number(</span><br><span class="line">    replace(</span><br><span class="line">    <span class="built_in">translate</span>(<span class="built_in">lower</span>(data),</span><br><span class="line">     <span class="string">&#x27;abcdefghijklmnopqrstuvwxyz&#x27;</span>,</span><br><span class="line">     rpad(<span class="string">&#x27;z&#x27;</span>,<span class="number">26</span>,<span class="string">&#x27;z&#x27;</span>)),<span class="string">&#x27;z&#x27;</span>)) sal</span><br><span class="line"> <span class="keyword">from</span> (</span><br><span class="line">   <span class="keyword">select</span> ename<span class="operator">||</span>sal data</span><br><span class="line">   <span class="keyword">from</span> emp</span><br><span class="line">)</span><br></pre></td></tr></table></figure></li>
<li>MYSQL<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span>	</span><br><span class="line"> data,	</span><br><span class="line"> REGEXP_REPLACE(data,	<span class="string">&#x27;[0-9]&#x27;</span>,	<span class="string">&#x27;&#x27;</span>)	<span class="keyword">AS</span>	characters,	</span><br><span class="line"> REGEXP_REPLACE(data,	<span class="string">&#x27;[^0-9]&#x27;</span>,	<span class="string">&#x27;&#x27;</span>)	<span class="keyword">AS</span>	digits</span><br><span class="line"> <span class="keyword">FROM</span>	emp</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="字符串筛选"><a href="#字符串筛选" class="headerlink" title="字符串筛选"></a>字符串筛选</h3><ul>
<li>从表里筛选出部分行数据，筛选条件是只包含字母和数字字符</li>
<li>([^a-dX]匹配除 “a”、“b”、“c”、“d”、“X” 以外的任何字符。)</li>
<li>0是不匹配，1是匹配<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> data</span><br><span class="line"><span class="keyword">from</span> V</span><br><span class="line"><span class="keyword">where</span> data regexp <span class="string">&#x27;[^0-9a-zA-Z]&#x27;</span> <span class="operator">=</span> <span class="number">0</span> </span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="通配符"><a href="#通配符" class="headerlink" title="通配符"></a>通配符</h3><ul>
<li>[charlist]	字符列中的任何单一字符</li>
<li>[^charlist] 不在字符列中的任何单一字符</li>
<li>“%” 百分号通配符: 表示任何字符出现任意次数 (可以是0次)。</li>
<li>“<em>“ 下划线通配符:表示只能匹配单个字符,不能多也不能少,就是一个字符。当然，也可以like “陈</em>___”，数量不限。</li>
<li>like操作符:LIKE作用是指示mysql后面的搜索模式是利用通配符而不是直接相等匹配进行比较；但如果like后面没出现通配符，则在SQL执行优化时将 like 默认为 “&#x3D;”执行</li>
</ul>
<h3 id="Group-concat函数"><a href="#Group-concat函数" class="headerlink" title="Group_concat函数"></a>Group_concat函数</h3><ul>
<li>分类把一个字段的集合到一起<br><img src="/2024/05/21/SQL/image3.png" alt="alt text"></li>
<li>group_concat([DISTINCT] 要连接的字段 [Order BY ASC&#x2F;DESC 排序字段] [Separator ‘分隔符’])</li>
<li><code>SELECT id,GROUP_CONCAT(score ORDER BY score DESC) FROM testgroup GROUP BY id</code><br><img src="/2024/05/21/SQL/image4.png" alt="alt text"></li>
<li><code>SELECT id,GROUP_CONCAT(score SEPARATOR &#39;;&#39;) FROM testgroup GROUP BY id</code></li>
</ul>
<h2 id="题型总结"><a href="#题型总结" class="headerlink" title="题型总结"></a>题型总结</h2><h3 id="全部参与类"><a href="#全部参与类" class="headerlink" title="全部参与类"></a>全部参与类</h3><ol>
<li>employee， project(eno,pno)表，找出所有员工都参与的项目.<br>思路：项目的参与人数 &#x3D; 员工人数<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> pno</span><br><span class="line"><span class="keyword">FROM</span> works</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> pno</span><br><span class="line"><span class="keyword">HAVING</span> <span class="built_in">COUNT</span>(<span class="keyword">DISTINCT</span> eno) <span class="operator">=</span> (<span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">FROM</span> employees);</span><br></pre></td></tr></table></figure></li>
<li>sailor，reserve，boats表，找出预定了所有船的员工(相当于找出参与了所有项目的员工)<br>思路：通过group by找出每个人租的所有船，租船的数目 &#x3D; 船的总数(注意去重)<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> sailors.sname </span><br><span class="line"><span class="keyword">FROM</span> sailors</span><br><span class="line"><span class="keyword">JOIN</span> reserves <span class="keyword">ON</span> reserves.sid <span class="operator">=</span> sailors.sid</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> sailors.sid, sailors.sname</span><br><span class="line"><span class="keyword">HAVING</span> <span class="built_in">COUNT</span>(<span class="keyword">DISTINCT</span> reserves.bid) <span class="operator">=</span> (<span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">FROM</span> boats);</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="多表连接，多条件"><a href="#多表连接，多条件" class="headerlink" title="多表连接，多条件"></a>多表连接，多条件</h3><ul>
<li>sailor，reserve，boats表，找出年龄在35岁以上，并且在2020-08-01至2020-08-31期间同时预定了红色船（RED）和绿色船（GREEN）的水手，结果返回水手姓名sname。<br>思路：用sid判断这个id是不是同时满足多个要求，而不是看id对应的人是不是同时租了两种船<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> s.sname</span><br><span class="line"><span class="keyword">FROM</span> sailors s</span><br><span class="line"><span class="keyword">WHERE</span> s.age <span class="operator">&gt;</span> <span class="number">35</span></span><br><span class="line"><span class="keyword">AND</span> s.sid <span class="keyword">IN</span> (</span><br><span class="line">   <span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> r1.sid</span><br><span class="line">   <span class="keyword">FROM</span> reserves r1</span><br><span class="line">   <span class="keyword">JOIN</span> boats b1 <span class="keyword">ON</span> r1.bid <span class="operator">=</span> b1.bid</span><br><span class="line">   <span class="keyword">WHERE</span> b1.color <span class="operator">=</span> <span class="string">&#x27;GREEN&#x27;</span></span><br><span class="line">   <span class="keyword">AND</span> r1.reserve_date <span class="keyword">BETWEEN</span> <span class="string">&#x27;2020-08-01&#x27;</span> <span class="keyword">AND</span> <span class="string">&#x27;2020-08-31&#x27;</span></span><br><span class="line">)</span><br><span class="line"><span class="keyword">AND</span> s.sid <span class="keyword">IN</span> (</span><br><span class="line">   <span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> r2.sid</span><br><span class="line">   <span class="keyword">FROM</span> reserves r2</span><br><span class="line">   <span class="keyword">JOIN</span> boats b2 <span class="keyword">ON</span> r2.bid <span class="operator">=</span> b2.bid</span><br><span class="line">   <span class="keyword">WHERE</span> b2.color <span class="operator">=</span> <span class="string">&#x27;RED&#x27;</span></span><br><span class="line">   <span class="keyword">AND</span> r2.reserve_date <span class="keyword">BETWEEN</span> <span class="string">&#x27;2020-08-01&#x27;</span> <span class="keyword">AND</span> <span class="string">&#x27;2020-08-31&#x27;</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="分区"><a href="#分区" class="headerlink" title="分区"></a>分区</h3><ul>
<li>用户表，订单表，产品表，找到每个用户最近三笔订单。若用户订单少于3笔，则返回该用户的全部订单，找到每个用户的最近三笔订单。如果用户的订单少于 3 笔，则返回他的全部订单。返回的结果按照 customer_name 升序 排列。如果有相同的排名，则按照 customer_id 升序 排列。如果排名还有相同，则按照 order_date 降序 排列。 <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*LEETCODE 1532*/</span></span><br><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">   c.name customer_name,</span><br><span class="line">   c.customer_id, </span><br><span class="line">   t.order_id, </span><br><span class="line">   t.order_date</span><br><span class="line"><span class="keyword">FROM</span> (</span><br><span class="line">   <span class="keyword">SELECT</span>  </span><br><span class="line">      order_id,</span><br><span class="line">      order_date,</span><br><span class="line">      customer_id,</span><br><span class="line">      <span class="built_in">row_number</span>() <span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span> customer_id <span class="keyword">order</span> <span class="keyword">by</span> order_date <span class="keyword">DESC</span>) <span class="keyword">as</span> rank_tag</span><br><span class="line">   <span class="keyword">FROM</span> orders ) t</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> customers c  </span><br><span class="line">   <span class="keyword">ON</span> t.customer_id <span class="operator">=</span> c.customer_id    </span><br><span class="line"><span class="keyword">WHERE</span> </span><br><span class="line">   rank_tag <span class="operator">&lt;=</span> <span class="number">3</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> </span><br><span class="line">   name, customer_id, order_date <span class="keyword">DESC</span>;</span><br></pre></td></tr></table></figure>
 当然我们也可以不用分区的函数，直接手搓。。也就会是对于每一个Order，我们都直接计算它的rank，rank的计算就是再次遍历order表，得出比他大的个数 <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> name customer_name, order_id, order_date</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">(</span><br><span class="line">   <span class="keyword">select</span></span><br><span class="line">      o1.customer_id,</span><br><span class="line">      o1.order_id,</span><br><span class="line">      o1.order_date,</span><br><span class="line">      (</span><br><span class="line">      <span class="keyword">select</span></span><br><span class="line">         <span class="number">1</span> <span class="operator">+</span> <span class="built_in">count</span>(<span class="operator">*</span>)</span><br><span class="line">      <span class="keyword">from</span></span><br><span class="line">         orders o7</span><br><span class="line">      <span class="keyword">where</span></span><br><span class="line">         o7.customer_id <span class="operator">=</span> o1.customer_id</span><br><span class="line">         <span class="keyword">and</span> o7.order_date <span class="operator">&gt;</span> o1.order_date</span><br><span class="line">      ) <span class="keyword">as</span> rnk</span><br><span class="line">   <span class="keyword">from</span></span><br><span class="line">      orders o1</span><br><span class="line">) t</span><br><span class="line"><span class="keyword">left</span> <span class="keyword">join</span> customers <span class="keyword">on</span> customers.customer_id <span class="operator">=</span> t.customer_id</span><br><span class="line"><span class="keyword">where</span> rnk <span class="operator">&lt;=</span> <span class="number">3</span></span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> name <span class="keyword">asc</span>, order_date <span class="keyword">desc</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="参与最多"><a href="#参与最多" class="headerlink" title="参与最多"></a>参与最多</h3><p>很套路且符合直觉，一般就是count+group by+order by+limit</p>
<ul>
<li>编写一个sql语句，查询参加比赛场次最多的选手，若参与比赛场次相同，选择用户编号player_id较小的选手，结果返回用户编号player_id和参与的比赛数量match_num。<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> players.player_id,<span class="built_in">COUNT</span>(matches.match_id)</span><br><span class="line"><span class="keyword">FROM</span> players</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> <span class="keyword">matches</span></span><br><span class="line"><span class="keyword">ON</span> matches.first_player <span class="operator">=</span> players.player_id <span class="keyword">OR</span> matches.second_player <span class="operator">=</span> players.player_id</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> players.player_id</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="built_in">COUNT</span>(matches.match_id) <span class="keyword">DESC</span>, players.player_id <span class="keyword">ASC</span></span><br><span class="line">LIMIT <span class="number">1</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="统计一个id在两个字段上的出现和"><a href="#统计一个id在两个字段上的出现和" class="headerlink" title="统计一个id在两个字段上的出现和"></a>统计一个id在两个字段上的出现和</h3><ul>
<li><p>编写一个sql语句，找出拥有最多的好友的用户以及他拥有的好友数目，好友数相同时选择user_id较小的用户，结果返回用户编号user_id和好友数目friend_num。(request_id,accepter_id,accept_date) 是该表的主键，一个人可能会多次同意其他人的申请</p>
</li>
<li><p>统计某个id在requester_id和accepter_id中出现的次数和。直接使用union会合并重复数据，因此这里使用union all。统计后排序再取表中第一项即可。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> ids <span class="keyword">as</span> user_id, <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">as</span> friend_num</span><br><span class="line"><span class="keyword">FROM</span> (</span><br><span class="line">   <span class="keyword">SELECT</span> requester_id <span class="keyword">as</span> ids</span><br><span class="line">   <span class="keyword">FROM</span> accepted_requests</span><br><span class="line">   <span class="keyword">UNION</span> <span class="keyword">ALL</span></span><br><span class="line">   <span class="keyword">SELECT</span> accepter_id <span class="keyword">as</span> ids</span><br><span class="line">   <span class="keyword">FROM</span> accepted_requests</span><br><span class="line">) <span class="keyword">as</span> t</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> ids</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> friend_num <span class="keyword">DESC</span></span><br><span class="line">LIMIT <span class="number">1</span>;</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="子查询连接"><a href="#子查询连接" class="headerlink" title="子查询连接"></a>子查询连接</h3><ul>
<li>有时我们想要多次枚举某个字段的值，比如这道题，查询登录新用户个数不少于2个的日期，结果返回日期login_date和登录新用户个数new_user_num，以login_date升序排序。我们的一种想法是：先找出所有日期，再对于每个日期，看看那一天是否有新用户（也就是用户第一次登录就是那一天）<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line">t1.login_date,</span><br><span class="line"><span class="built_in">count</span>(t2.user_id) <span class="keyword">as</span> new_user_num</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">(</span><br><span class="line">   <span class="keyword">select</span></span><br><span class="line">      <span class="keyword">distinct</span> login_date</span><br><span class="line">   <span class="keyword">from</span></span><br><span class="line">      logins</span><br><span class="line">) t1</span><br><span class="line"><span class="keyword">left</span> <span class="keyword">join</span> (</span><br><span class="line">   <span class="keyword">select</span></span><br><span class="line">      user_id,</span><br><span class="line">      <span class="built_in">min</span>(login_date) first_date</span><br><span class="line">   <span class="keyword">from</span></span><br><span class="line">      logins</span><br><span class="line">   <span class="keyword">group</span> <span class="keyword">by</span></span><br><span class="line">      user_id</span><br><span class="line">) t2 <span class="keyword">on</span> t1.login_date <span class="operator">=</span> t2.first_date</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span></span><br><span class="line">t1.login_date</span><br><span class="line"><span class="keyword">having</span></span><br><span class="line">new_user_num <span class="operator">&gt;=</span> <span class="number">2</span></span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span></span><br><span class="line">t1.login_date <span class="keyword">asc</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="时间处理"><a href="#时间处理" class="headerlink" title="时间处理"></a>时间处理</h3><ul>
<li>编写一个sql语句，查询每个月的通过率，结果返回月份mon及通过率accept_rate（不包括通过率为0的月份），以mon升序排列。<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line">  a_m1.mon,</span><br><span class="line">  a_m2.count2 <span class="operator">/</span> a_m1.count1 <span class="keyword">as</span> accept_rate</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">  (</span><br><span class="line">    <span class="keyword">select</span></span><br><span class="line">      mon,</span><br><span class="line">      <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">as</span> count1</span><br><span class="line">    <span class="keyword">from</span>(</span><br><span class="line">        <span class="keyword">select</span></span><br><span class="line">          sender_id,</span><br><span class="line">          send_to_id,</span><br><span class="line">          <span class="keyword">month</span>(request_date) <span class="keyword">as</span> mon</span><br><span class="line">        <span class="keyword">from</span></span><br><span class="line">          friend_requests</span><br><span class="line">      ) <span class="keyword">as</span> t1 <span class="comment">/* 提取每个申请的月份 */</span></span><br><span class="line">    <span class="keyword">group</span> <span class="keyword">by</span></span><br><span class="line">      mon</span><br><span class="line">  ) <span class="keyword">as</span> a_m1, <span class="comment">/* 计算每个月的申请总数 */</span></span><br><span class="line">  (</span><br><span class="line">    <span class="keyword">select</span></span><br><span class="line">      mon,</span><br><span class="line">      <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">as</span> count2</span><br><span class="line">    <span class="keyword">from</span>(</span><br><span class="line">        <span class="keyword">select</span></span><br><span class="line">          requester_id,</span><br><span class="line">          accepter_id,</span><br><span class="line">          <span class="keyword">month</span>(accept_date) <span class="keyword">as</span> mon</span><br><span class="line">        <span class="keyword">from</span></span><br><span class="line">          accepted_requests</span><br><span class="line">      ) <span class="keyword">as</span> t1 <span class="comment">/* 提取每个接受的月份 */</span></span><br><span class="line">    <span class="keyword">group</span> <span class="keyword">by</span></span><br><span class="line">      mon</span><br><span class="line">  ) <span class="keyword">as</span> a_m2 <span class="comment">/* 计算每个月的接受总数 */</span></span><br><span class="line"><span class="keyword">where</span></span><br><span class="line">  a_m1.mon <span class="operator">=</span> a_m2.mon</span><br><span class="line">  <span class="keyword">and</span> a_m1.count1 <span class="operator">/</span> a_m2.count2 <span class="operator">!=</span> <span class="number">0</span></span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span></span><br><span class="line">  a_m1.mon <span class="keyword">asc</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="数学问题"><a href="#数学问题" class="headerlink" title="数学问题"></a>数学问题</h3><ul>
<li><strong>中位数</strong>：编写一个sql语句，查询各个岗位分数升序排列之后的中位数所在的位置start，end（范围从1开始，一个岗位参与人数为单数时 start &#x3D; end，为偶数时 end &#x3D; start + 1），以job升序排序。</li>
<li>用IF处理奇数偶数的情况<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> job, </span><br><span class="line">   IF(<span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="operator">%</span> <span class="number">2</span> <span class="operator">=</span> <span class="number">0</span>, <span class="built_in">CEILING</span>(<span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="operator">/</span> <span class="number">2</span>), <span class="built_in">CEILING</span>(<span class="built_in">COUNT</span>(<span class="operator">*</span>)<span class="operator">/</span> <span class="number">2</span>)) <span class="keyword">start</span>,</span><br><span class="line">   IF(<span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="operator">%</span> <span class="number">2</span> <span class="operator">=</span> <span class="number">0</span>, <span class="built_in">CEILING</span>(<span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="operator">/</span> <span class="number">2</span> <span class="operator">+</span> <span class="number">1</span>), <span class="built_in">CEILING</span>(<span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="operator">/</span> <span class="number">2</span>)) <span class="keyword">end</span></span><br><span class="line"><span class="keyword">FROM</span> grades</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> job</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> job <span class="keyword">ASC</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="利用any处理非最大最小"><a href="#利用any处理非最大最小" class="headerlink" title="利用any处理非最大最小"></a>利用any处理非最大最小</h3><ul>
<li>找出那些既没有最多，也没有最少参与者的活动的名字。Activities 表中的任意活动都有在 Friends 中参与过。可以以任何顺序返回结果。<br><img src="/2024/05/21/SQL/image2.png"><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> activity <span class="keyword">as</span> ACTIVITY</span><br><span class="line"><span class="keyword">from</span> friends</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> activity</span><br><span class="line"><span class="keyword">having</span> <span class="built_in">count</span>(<span class="operator">*</span>)<span class="operator">&gt;</span><span class="keyword">any</span>(</span><br><span class="line">    <span class="keyword">select</span> <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">from</span> friends <span class="keyword">group</span> <span class="keyword">by</span> activity</span><br><span class="line">) <span class="keyword">and</span> <span class="built_in">count</span>(<span class="operator">*</span>)<span class="operator">&lt;</span><span class="keyword">any</span>(</span><br><span class="line">    <span class="keyword">select</span> <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">from</span> friends <span class="keyword">group</span> <span class="keyword">by</span> activity</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
当然我们也可以还是就用max和min<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">WITH</span> TT <span class="keyword">AS</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> activity,</span><br><span class="line">    <span class="built_in">COUNT</span>(id) <span class="keyword">AS</span> times</span><br><span class="line">    <span class="keyword">FROM</span> Friends</span><br><span class="line">    <span class="keyword">GROUP</span> <span class="keyword">BY</span> Friends.activity </span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> activity <span class="keyword">FROM</span> TT</span><br><span class="line"><span class="keyword">WHERE</span> times <span class="operator">&lt;</span> (<span class="keyword">SELECT</span> <span class="built_in">MAX</span>(times) <span class="keyword">FROM</span> TT)</span><br><span class="line">  <span class="keyword">AND</span> times <span class="operator">&gt;</span> (<span class="keyword">SELECT</span> <span class="built_in">MIN</span>(times) <span class="keyword">FROM</span> TT)</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="排序"><a href="#排序" class="headerlink" title="排序"></a>排序</h3><ul>
<li>第x高的就是LIMIT + OFFSET即可</li>
<li>查询并返回 Employee 表中第二高的薪水 。如果不存在第二高的薪水，查询应该返回 null(Pandas 则返回 None) 。<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> ifnull(</span><br><span class="line">(<span class="keyword">select</span> <span class="keyword">distinct</span> salary</span><br><span class="line"> <span class="keyword">as</span> SecondHighestSalary</span><br><span class="line"><span class="keyword">from</span> Employee</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> salary <span class="keyword">desc</span></span><br><span class="line">limit <span class="number">1</span> <span class="keyword">offset</span> <span class="number">1</span>),<span class="keyword">null</span>) <span class="keyword">as</span> SecondHighestSalary</span><br></pre></td></tr></table></figure></li>
<li>连接表<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line">d.department_name <span class="keyword">as</span> department,</span><br><span class="line">e.name,</span><br><span class="line">e.salary</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">employees e</span><br><span class="line"><span class="keyword">join</span> departments d</span><br><span class="line"><span class="keyword">on</span>  e.department_id <span class="operator">=</span> d.department_id</span><br><span class="line"><span class="keyword">where</span></span><br><span class="line">   salary <span class="operator">=</span> IFNULL(</span><br><span class="line">   (</span><br><span class="line">      <span class="keyword">select</span></span><br><span class="line">      <span class="keyword">distinct</span> e1.salary</span><br><span class="line">      <span class="keyword">from</span></span><br><span class="line">      employees <span class="keyword">as</span> e1</span><br><span class="line">      <span class="keyword">where</span></span><br><span class="line">      e.department_id <span class="operator">=</span> e1.department_id</span><br><span class="line">      <span class="keyword">order</span> <span class="keyword">by</span></span><br><span class="line">      e1.salary <span class="keyword">desc</span></span><br><span class="line">      limit</span><br><span class="line">      <span class="number">1</span>, <span class="number">1</span></span><br><span class="line">   ), <span class="number">0</span></span><br><span class="line">)</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span></span><br><span class="line">department</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li>编写一个sql语句，找出每个部门获得前三高工资的所有员工，结果返回部门名称department，员工姓名name和工资salary，以department升序，salary降序排列。</li>
<li>这题还是直接找比某个薪水大的个数比较好，row_number是不连续的肯定不行，rank又不能用&lt;&#x3D;3来挑选<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line"> d.department_name,</span><br><span class="line"> e.name,</span><br><span class="line"> e.salary</span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">   employees e</span><br><span class="line"><span class="keyword">JOIN</span></span><br><span class="line">   departments d <span class="keyword">ON</span> e.department_id <span class="operator">=</span> d.department_id</span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line">   (<span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>) </span><br><span class="line">   <span class="keyword">FROM</span> employees e2 </span><br><span class="line">   <span class="keyword">WHERE</span> e2.department_id <span class="operator">=</span> e.department_id </span><br><span class="line">      <span class="keyword">AND</span> e2.salary <span class="operator">&gt;</span> e.salary) <span class="operator">&lt;</span> <span class="number">3</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span></span><br><span class="line">   d.department_name <span class="keyword">ASC</span>,</span><br><span class="line">   e.salary <span class="keyword">DESC</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="找出当前月份的第一个和最后一个星期三"><a href="#找出当前月份的第一个和最后一个星期三" class="headerlink" title="找出当前月份的第一个和最后一个星期三"></a>找出当前月份的第一个和最后一个星期三</h3><p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/6660392a477b">https://www.jianshu.com/p/6660392a477b</a></p>
<p>+ </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">MAKEDATE(<span class="keyword">YEAR</span>(CURDATE()), <span class="number">1</span>) <span class="operator">+</span> <span class="type">INTERVAL</span> QUARTER(CURDATE()) QUARTER <span class="operator">-</span> <span class="type">INTERVAL</span> <span class="number">1</span> QUARTER <span class="comment">--计算当前季度的起始日期。</span></span><br><span class="line">MAKEDATE(<span class="keyword">YEAR</span>(CURDATE()), <span class="number">1</span>) <span class="operator">+</span> <span class="type">INTERVAL</span> QUARTER(CURDATE()) QUARTER <span class="operator">-</span> <span class="type">INTERVAL</span> <span class="number">1</span> QUARTER <span class="operator">+</span> <span class="type">INTERVAL</span> <span class="number">3</span> <span class="keyword">MONTH</span> <span class="operator">-</span> <span class="type">INTERVAL</span> <span class="number">1</span> <span class="keyword">DAY</span> <span class="comment">--计算当前季度的结束日期。</span></span><br></pre></td></tr></table></figure>
<p>  为什么要减可以这样理解，一开始放到1月1号就是有一个quarter了</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2024/05/21/SQL/" data-id="clwlwacy10004qkvcfhzhaq8q" data-title="SQL" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2024/05/21/%E5%86%8D%E7%9C%8B%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          再看动态规划
        
      </div>
    </a>
  
  
    <a href="/2024/05/20/Makefile%E8%AF%AD%E6%B3%95/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">Makefile语法</div>
    </a>
  
</nav>

  
</article>


</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/JAVA/">JAVA</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/LCR119/">LCR119</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/LeetCode101/">LeetCode101</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/LeetCode101/%E5%9B%9E%E6%BA%AF/">回溯</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/LeetCode101/%E6%B7%B1%E5%BA%A6%E4%BC%98%E5%85%88%E6%90%9C%E7%B4%A2/">深度优先搜索</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/">Linux</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Makefile/">Makefile</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/REDIS/">REDIS</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Spring/">Spring</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%88%86%E5%B8%83%E5%BC%8F/">分布式</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%88%86%E5%B8%83%E5%BC%8F/MIT-6824/">MIT-6824</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%88%86%E5%B8%83%E5%BC%8F%E6%8A%80%E6%9C%AF%E6%A0%88/">分布式技术栈</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%88%86%E5%B8%83%E5%BC%8F%E6%8A%80%E6%9C%AF%E6%A0%88/%E7%B3%BB%E7%BB%9F%E6%9E%B6%E6%9E%84/">系统架构</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%89%8D%E7%AB%AF/">前端</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%89%8D%E7%AB%AF/CSS/">CSS</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%89%8D%E7%AB%AF/HTML/">HTML</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%89%8D%E7%AB%AF/TypeScript/">TypeScript</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%AE%9E%E4%B9%A0/">实习</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%AE%9E%E4%B9%A0/baosight/">baosight</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%AE%9E%E4%B9%A0/baosight/OPC-UA/">OPC_UA</a></li></ul></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/">操作系统</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/">数据库</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/SQL/">SQL</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%97%A5%E5%B8%B8%E5%BC%80%E5%8F%91/">日常开发</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%A7%91%E7%A0%94/">科研</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%A7%91%E7%A0%94/ImageMatchingfromHandcraftedtoDeepFeatures-ASurvey/">ImageMatchingfromHandcraftedtoDeepFeatures:ASurvey</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%AE%97%E6%B3%95/">算法</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%AE%97%E6%B3%95/%E5%88%86%E6%B2%BB/">分治</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%AE%97%E6%B3%95/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92/">动态规划</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%AE%97%E6%B3%95/%E5%B8%B8%E7%94%A8%E7%AE%97%E6%B3%95/">常用算法</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%BD%91%E7%BB%9C/">网络</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E8%AF%BE%E7%A8%8B/">课程</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/%E8%AF%BE%E7%A8%8B/%E8%BD%AF%E4%BB%B6%E8%AE%BE%E8%AE%A1/">软件设计</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E9%A1%B9%E7%9B%AE/">项目</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/%E9%A1%B9%E7%9B%AE/%E6%8F%8F%E8%BF%B0%E4%B8%8E%E9%9D%A2%E8%AF%95/">描述与面试</a></li></ul></li></ul>
    </div>
  </div>


  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/11/">November 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/10/">October 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/09/">September 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/07/">July 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/06/">June 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/05/">May 2024</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2024/11/05/OPCUA-open62541%E8%AE%A2%E9%98%85%E5%8E%9F%E7%90%86/">open62541-订阅监视</a>
          </li>
        
          <li>
            <a href="/2024/11/03/Spring-%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5/">Spring-Bean&amp;依赖注入</a>
          </li>
        
          <li>
            <a href="/2024/11/01/%E7%AE%80%E5%8E%86%E5%86%85%E5%AE%B9/">简历内容</a>
          </li>
        
          <li>
            <a href="/2024/11/01/OPCUA%E4%BA%8B%E4%BB%B6/">OPCUA事件</a>
          </li>
        
          <li>
            <a href="/2024/10/29/OPCUA-open62541%E5%A4%9A%E8%8A%82%E7%82%B9%E8%AE%A2%E9%98%85/">OPCUA open62541-多节点订阅实现</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2024 John Doe<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.6.4.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>